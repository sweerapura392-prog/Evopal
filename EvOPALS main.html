<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Evopals Life Hub - Full Deck</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        [x-cloak] { display: none !important; }
        
        :root { --app-height: 100vh; }

        html, body { 
            margin: 0; 
            padding: 0;
            width: 100vw;
            height: var(--app-height);
            overflow: hidden;
            background: #000;
            position: fixed;
            font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #ff75c3, #ffa647, #7043ff);
            background-size: 400% 400%;
            animation: gradientMove 15s ease infinite;
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
            z-index: -1;
        }
        @keyframes gradientMove { 0% { background-position: 0% 50% } 50% { background-position: 100% 50% } 100% { background-position: 0% 50% } }
        
        .main-app {
            height: var(--app-height);
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        .glass { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .nav-active { background: white !important; color: black !important; transform: translateY(-3px); }
        
        .float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        input, button { font-size: 16px !important; }

        /* Calculator Specifics */
        .calc-btn { transition: all 0.1s; }
        .calc-btn:active { transform: scale(0.9); background: white; color: black; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>

    <script>
        const setAppHeight = () => {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        };
        window.addEventListener('resize', setAppHeight);
        window.addEventListener('orientationchange', setAppHeight);
        setAppHeight();

        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : { apiKey: "local", authDomain: "local", projectId: "local" };
            
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'evopals-v15';

        let db = null;
        let auth = null;
        if (firebaseConfig.apiKey !== "local") {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        }

        window.evopals = function() {
            return {
                screen: 'loading',
                activeTab: 'planner',
                userId: null,
                petName: 'Nova',
                petEmoji: 'üê±',
                level: 1,
                xp: 0,
                allData: {},
                showIdModal: false,
                tempId: '',
                activeTool: null,
                calcDisplay: '0',
                compassHeading: 0,

                async init() {
                    if (!auth) { this.screen = 'app'; return; }
                    auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            this.userId = user.uid;
                            await this.loadData();
                            this.screen = 'app';
                        } else {
                            await auth.signInAnonymously();
                        }
                    });

                    if (window.DeviceOrientationEvent) {
                        window.addEventListener('deviceorientation', (e) => {
                            this.compassHeading = e.webkitCompassHeading || (360 - e.alpha);
                        }, true);
                    }
                },

                async loadData() {
                    if (!db || !this.userId) return;
                    const doc = await db.collection('artifacts').doc(appId).collection('users').doc(this.userId).collection('data').doc('master').get();
                    if (doc.exists) {
                        const d = doc.data();
                        this.petName = d.petName || 'Nova';
                        this.petEmoji = d.petEmoji || 'üê±';
                        this.level = d.level || 1;
                        this.xp = d.xp || 0;
                        this.allData = d.allData || {};
                    }
                },

                async saveData() {
                    if (!db || !this.userId) return;
                    await db.collection('artifacts').doc(appId).collection('users').doc(this.userId).collection('data').doc('master').set({
                        petName: this.petName, petEmoji: this.petEmoji, level: this.level, xp: this.xp, allData: this.allData
                    }, { merge: true });
                },

                async syncWithId() {
                    if (!this.tempId.trim()) return;
                    this.userId = this.tempId.trim();
                    await this.loadData();
                    this.showIdModal = false;
                },

                copyId() {
                    const el = document.createElement('textarea');
                    el.value = this.userId;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                },

                // Tools Logic
                calcInput(val) {
                    if (this.calcDisplay === '0') this.calcDisplay = val;
                    else this.calcDisplay += val;
                },
                calcClear() { this.calcDisplay = '0'; },
                calcResult() {
                    try { this.calcDisplay = eval(this.calcDisplay.replace('√ó', '*').replace('√∑', '/')).toString(); }
                    catch (e) { this.calcDisplay = 'Error'; }
                }
            }
        }
    </script>
</head>
<body x-data="evopals()" x-init="init()">

    <div class="gradient-bg"></div>

    <template x-if="screen === 'loading'">
        <div class="fixed inset-0 flex flex-col items-center justify-center text-white z-[500]">
            <div class="text-8xl float">üê±</div>
            <h1 class="mt-4 font-black italic text-2xl tracking-tighter">BOOTING...</h1>
        </div>
    </template>

    <div x-show="screen === 'app'" x-cloak class="main-app">
        
        <header class="p-4 pt-6 flex justify-between items-center">
            <h1 class="text-white font-black italic text-xl tracking-tighter">EVOPALS</h1>
            <button @click="showIdModal = true" class="glass px-4 py-2 rounded-xl text-[10px] font-bold text-white uppercase tracking-widest">Account</button>
        </header>

        <main class="flex-1 overflow-y-auto px-4 pb-24 no-scrollbar">
            
            <!-- HUB -->
            <div x-show="activeTab === 'planner'" class="space-y-6 pt-2">
                <div class="glass p-8 rounded-[2.5rem] flex flex-col items-center text-center shadow-xl">
                    <div class="text-7xl float mb-4 drop-shadow-lg" x-text="petEmoji"></div>
                    <h2 class="text-white text-3xl font-black italic" x-text="petName"></h2>
                    <div class="w-32 h-2 bg-white/10 rounded-full mt-4 overflow-hidden">
                        <div class="h-full bg-white" :style="`width: ${xp}%`"></div>
                    </div>
                    <p class="text-[8px] font-black uppercase opacity-40 mt-2">Level <span x-text="level"></span></p>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center text-white px-2">
                        <h3 class="font-bold uppercase text-xs tracking-widest opacity-60">Daily Goals</h3>
                        <button class="text-cyan-400 font-bold text-xs">+ ADD</button>
                    </div>
                    <div class="glass p-6 rounded-3xl flex items-center gap-4 text-white">
                        <div class="w-6 h-6 border-2 border-white/30 rounded-lg"></div>
                        <span class="font-bold text-sm">Welcome back!</span>
                    </div>
                </div>
            </div>

            <!-- DECK (Apps) -->
            <div x-show="activeTab === 'deck'" class="space-y-6 pt-2">
                <h2 class="text-white text-3xl font-black italic mb-6">THE DECK</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button @click="activeTool = 'calc'" class="glass aspect-square rounded-[2rem] flex flex-col items-center justify-center gap-3">
                        <span class="text-4xl">üî¢</span>
                        <span class="text-[10px] font-black uppercase text-white tracking-widest">Calc</span>
                    </button>
                    <button @click="activeTool = 'compass'" class="glass aspect-square rounded-[2rem] flex flex-col items-center justify-center gap-3">
                        <span class="text-4xl">üß≠</span>
                        <span class="text-[10px] font-black uppercase text-white tracking-widest">Compass</span>
                    </button>
                </div>
            </div>

            <!-- LAB -->
            <div x-show="activeTab === 'lab'" class="space-y-6 pt-2">
                <h2 class="text-white text-3xl font-black italic mb-6">THE LAB</h2>
                <div class="glass p-8 rounded-[2.5rem] space-y-8">
                    <div class="flex items-center justify-between">
                        <button @click="petEmoji = 'üê∂'; saveData()" class="text-4xl glass p-4 rounded-2xl">üê∂</button>
                        <div class="text-8xl" x-text="petEmoji"></div>
                        <button @click="petEmoji = 'ü¶ä'; saveData()" class="text-4xl glass p-4 rounded-2xl">ü¶ä</button>
                    </div>
                    <input x-model="petName" @blur="saveData()" class="w-full bg-white/10 border border-white/20 p-4 rounded-2xl text-white text-center font-black text-xl outline-none">
                </div>
            </div>
        </main>

        <!-- Nav -->
        <nav class="fixed bottom-4 left-4 right-4 glass p-2 rounded-[2rem] flex gap-2 z-[100] shadow-2xl">
            <button @click="activeTab = 'planner'" :class="activeTab === 'planner' ? 'nav-active' : 'text-white/50'" class="flex-1 py-4 rounded-[1.5rem] flex flex-col items-center gap-1 transition-all">
                <span class="text-xl">üè†</span>
                <span class="text-[8px] font-black uppercase">Hub</span>
            </button>
            <button @click="activeTab = 'deck'" :class="activeTab === 'deck' ? 'nav-active' : 'text-white/50'" class="flex-1 py-4 rounded-[1.5rem] flex flex-col items-center gap-1 transition-all">
                <span class="text-xl">üõ†Ô∏è</span>
                <span class="text-[8px] font-black uppercase">Deck</span>
            </button>
            <button @click="activeTab = 'lab'" :class="activeTab === 'lab' ? 'nav-active' : 'text-white/50'" class="flex-1 py-4 rounded-[1.5rem] flex flex-col items-center gap-1 transition-all">
                <span class="text-xl">üêæ</span>
                <span class="text-[8px] font-black uppercase">Lab</span>
            </button>
        </nav>

        <!-- Calculator Overlay -->
        <div x-show="activeTool === 'calc'" x-transition class="fixed inset-0 z-[400] bg-black/95 flex items-center justify-center p-6" @click="activeTool = null">
            <div class="w-full max-w-xs glass rounded-[3rem] p-6 text-white" @click.stop>
                <div class="text-right p-6 text-4xl font-black mb-4 bg-black/20 rounded-2xl truncate" x-text="calcDisplay"></div>
                <div class="grid grid-cols-4 gap-2">
                    <template x-for="b in ['7','8','9','√∑','4','5','6','√ó','1','2','3','-','C','0','=','+']">
                        <button @click="b==='C'?calcClear():b==='='?calcResult():calcInput(b)" class="aspect-square glass rounded-xl flex items-center justify-center font-bold text-xl calc-btn" x-text="b"></button>
                    </template>
                </div>
            </div>
        </div>

        <!-- Compass Overlay -->
        <div x-show="activeTool === 'compass'" x-transition class="fixed inset-0 z-[400] bg-black/95 flex items-center justify-center p-6" @click="activeTool = null">
            <div class="text-center" @click.stop>
                <div class="w-64 h-64 border-4 border-white/20 rounded-full relative mx-auto mb-8 transition-transform duration-200" :style="`transform: rotate(${-compassHeading}deg)`">
                    <div class="absolute top-2 left-1/2 -translate-x-1/2 font-black text-white">N</div>
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-1 h-32 bg-red-500 origin-bottom"></div>
                </div>
                <div class="text-5xl font-black text-white italic" x-text="Math.round(compassHeading) + '¬∞'"></div>
                <button @click="activeTool = null" class="mt-8 text-white/40 uppercase text-[10px] font-black">Close</button>
            </div>
        </div>

        <!-- Sync Modal -->
        <div x-show="showIdModal" x-transition class="fixed inset-0 z-[500] bg-black/95 flex items-center justify-center p-6">
            <div class="glass w-full max-w-sm p-8 rounded-[2.5rem] text-white space-y-6" @click.stop>
                <h3 class="text-xl font-black italic uppercase">Account Sync</h3>
                <div class="space-y-4">
                    <p class="text-[10px] font-bold opacity-50 uppercase">Your Device ID</p>
                    <div class="flex gap-2">
                        <input readonly :value="userId" class="flex-1 bg-white/5 p-3 rounded-xl text-[8px] font-mono">
                        <button @click="copyId()" class="bg-white text-black px-3 rounded-xl text-[10px] font-bold">Copy</button>
                    </div>
                    <p class="text-[10px] font-bold opacity-50 uppercase pt-4">Load Other Profile</p>
                    <input x-model="tempId" placeholder="Paste ID..." class="w-full bg-white/5 p-4 rounded-xl outline-none border border-white/10">
                    <button @click="syncWithId()" class="w-full py-4 bg-cyan-500 rounded-2xl font-black uppercase italic">Sync Data</button>
                </div>
                <button @click="showIdModal = false" class="w-full text-[10px] font-bold opacity-30 uppercase pt-4">Dismiss</button>
            </div>
        </div>

    </div>
</body>
</html>